<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rholang WASM Eval</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background: #0f172a; color: #e2e8f0; }
      header { padding: 16px 24px; background: #111827; border-bottom: 1px solid #1f2937; }
      main { padding: 24px; display: grid; gap: 16px; max-width: 1000px; margin: 0 auto; }
      .row { display: grid; grid-template-columns: 1fr; gap: 16px; }
      @media (min-width: 900px) { .row { grid-template-columns: 1fr 1fr; } }
      textarea { width: 100%; min-height: 280px; background: #0b1220; color: #e5e7eb; border: 1px solid #1f2937; border-radius: 8px; padding: 12px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 14px; line-height: 1.5; }
      pre { width: 100%; min-height: 280px; background: #0b1220; color: #93c5fd; border: 1px solid #1f2937; border-radius: 8px; padding: 12px; white-space: pre-wrap; word-wrap: break-word; }
      button { background: #2563eb; color: white; border: 0; padding: 10px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      .toolbar { display: flex; gap: 12px; align-items: center; }
      .muted { color: #94a3b8; font-size: 12px; }
      footer { text-align: center; padding: 16px; color: #64748b; }
      .error { color: #fca5a5; }
    </style>
  </head>
  <body>
    <header>
      <h1>Rholang WebAssembly Shell</h1>
    </header>
    <main>
      <div class="toolbar">
        <button id="runBtn" disabled>Run (Cmd/Ctrl+Enter)</button>
        <span class="muted" id="status">Loading WebAssemblyâ€¦</span>
      </div>
      <div class="row">
        <section>
          <h3>Source</h3>
          <textarea id="editor" placeholder="Enter Rholang code here...

Example:
new x in { x!(42) }"></textarea>
        </section>
        <section>
          <h3>Result</h3>
          <pre id="output" aria-live="polite"></pre>
        </section>
      </div>
    </main>
    <footer>
      rholang-wasm demo
    </footer>

    <script type="module">
      import init, { evalRho } from "./pkg/rholang_wasm.js";

      const runBtn = document.getElementById("runBtn");
      const status = document.getElementById("status");
      const editor = document.getElementById("editor");
      const output = document.getElementById("output");

      async function runEval() {
        try {
          runBtn.disabled = true;
          status.textContent = "Running...";
          output.classList.remove('error');
          const code = editor.value;
          const result = await evalRho(code);
          output.textContent = String(result);
          status.textContent = "Ready";
        } catch (e) {
          output.textContent = `Error: ${e?.message ?? e}`;
          output.classList.add('error');
          status.textContent = "Error";
        } finally {
          runBtn.disabled = false;
        }
      }

      runBtn.addEventListener('click', () => { runEval(); });
      window.addEventListener('keydown', (e) => {
        if ((e.metaKey || e.ctrlKey) && e.key === 'Enter') {
          e.preventDefault();
          runEval();
        }
      });

      init().then(() => {
        status.textContent = "Ready";
        runBtn.disabled = false;
        editor.value = "new stdout(`rho:io:stdout`) in {\n  stdout!(\"Hello from Rholang!\")\n}";
      }).catch(err => {
        status.textContent = "Failed to initialize";
        output.textContent = String(err);
        output.classList.add('error');
      });
    </script>
  </body>
</html>