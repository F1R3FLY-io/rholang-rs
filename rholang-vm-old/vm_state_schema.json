{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://rholang.org/schemas/v1/vm_state_schema.json",
  "title": "Rholang VM State (GSLT/JSON)",
  "type": "object",
  "required": ["stack", "locals", "ip", "labels", "memory"],
  "properties": {
    "stack": {
      "type": "array",
      "items": { "$ref": "#/definitions/Value" }
    },
    "locals": {
      "type": "array",
      "items": { "$ref": "#/definitions/Value" }
    },
    "ip": { "type": "integer", "minimum": 0 },
    "labels": {
      "type": "object",
      "additionalProperties": false,
      "patternProperties": {
        ".*": { "type": "integer", "minimum": 0 }
      }
    },
    "memory": {
      "$ref": "#/definitions/Memory"
    },
    "rspaces": {
      "type": "array",
      "items": { "$ref": "#/definitions/RSpaceSnapshot" },
      "default": []
    }
  },
  "definitions": {
    "Value": {
      "description": "Serializable representation of runtime Value",
      "anyOf": [
        { "type": "object", "required": ["Int"], "properties": { "Int": { "type": "integer" } }, "additionalProperties": false },
        { "type": "object", "required": ["String"], "properties": { "String": { "type": "string" } }, "additionalProperties": false },
        { "type": "object", "required": ["Bool"], "properties": { "Bool": { "type": "boolean" } }, "additionalProperties": false },
        { "type": "object", "required": ["Process"], "properties": { "Process": { "type": "string" } }, "additionalProperties": false },
        { "type": "object", "required": ["Name"], "properties": { "Name": { "type": "string" } }, "additionalProperties": false },
        { "type": "object", "required": ["List"], "properties": { "List": { "type": "array", "items": { "$ref": "#/definitions/Value" } } }, "additionalProperties": false },
        { "type": "object", "required": ["Tuple"], "properties": { "Tuple": { "type": "array", "items": { "$ref": "#/definitions/Value" } } }, "additionalProperties": false },
        { "type": "object", "required": ["Map"], "properties": { "Map": { "type": "array", "items": { "type": "array", "minItems": 2, "maxItems": 2, "items": [ { "$ref": "#/definitions/Value" }, { "$ref": "#/definitions/Value" } ] } } }, "additionalProperties": false },
        { "type": "object", "required": ["Nil"], "properties": { "Nil": { "type": "null" } }, "additionalProperties": false },
        { "type": "string", "const": "Nil" },
        { "type": "integer" },
        { "type": "string" },
        { "type": "boolean" }
      ]
    },
    "PatternCompiled": {
      "type": "object",
      "required": ["key"],
      "properties": { "key": { "type": "string" } },
      "additionalProperties": false
    },
    "ContinuationRecord": {
      "type": "object",
      "required": ["proc_ref"],
      "properties": {
        "proc_ref": { "type": "string" },
        "env_id": { "type": ["integer", "null"], "minimum": 0 }
      },
      "additionalProperties": false
    },
    "Memory": {
      "type": "object",
      "required": ["constant_pool", "process_heap", "continuation_table", "pattern_cache", "name_registry"],
      "properties": {
        "constant_pool": {
          "type": "array",
          "items": { "$ref": "#/definitions/Value" }
        },
        "process_heap": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^[0-9]+$": { "$ref": "#/definitions/Value" }
          }
        },
        "continuation_table": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^[0-9]+$": { "$ref": "#/definitions/ContinuationRecord" }
          }
        },
        "pattern_cache": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            ".*": { "$ref": "#/definitions/PatternCompiled" }
          }
        },
        "name_registry": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            ".*": { "$ref": "#/definitions/Value" }
          }
        }
      },
      "additionalProperties": false
    },
    "RSpaceSnapshot": {
      "type": "object",
      "required": ["rspace_type", "channels"],
      "properties": {
        "rspace_type": {
          "type": "string",
          "enum": [
            "MemorySequential",
            "MemoryConcurrent",
            "StoreSequential",
            "StoreConcurrent"
          ]
        },
        "channels": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
